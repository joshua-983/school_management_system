<div class="card mb-4 border-0 shadow-sm">
    <div class="card-header bg-dark text-white py-3">
        <h6 class="card-title mb-0 d-flex align-items-center">
            <i class="fas fa-shield-alt me-2"></i>Security Overview
            <span class="badge bg-warning ms-2" id="security-alert-badge" 
                  style="display: {% if recent_security_events %}inline-block{% else %}none{% endif %};">
                {{ recent_security_events|length }}
            </span>
        </h6>
    </div>
    <div class="card-body">
        <div class="row text-center">
            <div class="col-4">
                <div class="border-end">
                    <h4 class="{% if blocked_users_count > 0 %}text-danger{% else %}text-success{% endif %} fw-bold">
                        {{ blocked_users_count }}
                    </h4>
                    <small class="text-muted">Blocked Users</small>
                </div>
            </div>
            <div class="col-4">
                <div class="border-end">
                    <h4 class="{% if maintenance_mode %}text-warning{% else %}text-success{% endif %} fw-bold">
                        {% if maintenance_mode %}ON{% else %}OFF{% endif %}
                    </h4>
                    <small class="text-muted">Maintenance</small>
                </div>
            </div>
            <div class="col-4">
                <div>
                    <h4 class="text-info fw-bold">{{ recent_security_events|length }}</h4>
                    <small class="text-muted">Security Events</small>
                </div>
            </div>
        </div>
        
        <div class="mt-3 d-grid gap-2">
            <a href="{% url 'security_dashboard' %}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-external-link-alt me-1"></i>Security Center
            </a>
        </div>
        
        {% if recent_security_events %}
        <div class="mt-3">
            <h6 class="text-muted small">Recent Security Events:</h6>
            <div class="list-group list-group-flush">
                {% for event in recent_security_events|slice:":3" %}
                <div class="list-group-item px-0 py-2">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-{{ event.get_icon }} text-{{ event.get_color }} me-2"></i>
                        <small class="flex-grow-1">{{ event.title|truncatewords:4 }}</small>
                    </div>
                    <small class="text-muted">{{ event.created_at|timesince }} ago</small>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Update security widget dynamically
function updateSecurityWidget() {
    fetch('{% url "security_stats_api" %}')
        .then(response => response.json())
        .then(data => {
            // Update blocked users count
            if (data.blocked_users !== undefined) {
                const blockedElement = document.querySelector('#security-widget-blocked');
                if (blockedElement) {
                    blockedElement.textContent = data.blocked_users;
                    blockedElement.className = data.blocked_users > 0 ? 
                        'text-danger fw-bold' : 'text-success fw-bold';
                }
            }
            
            // Update alert badge
            const badge = document.getElementById('security-alert-badge');
            if (badge && data.unresolved_events !== undefined) {
                if (data.unresolved_events > 0) {
                    badge.textContent = data.unresolved_events;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        })
        .catch(error => console.error('Error updating security widget:', error));
}

// Update every 30 seconds
setInterval(updateSecurityWidget, 30000);
</script>