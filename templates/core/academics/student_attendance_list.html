{% extends 'base.html' %}
{% load static %}

{% block title %}My Attendance - Ghana Education System{% endblock %}

{% block extra_css %}
<style>
    .attendance-card {
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .status-badge {
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .status-present { background-color: #d4edda; color: #155724; }
    .status-absent { background-color: #f8d7da; color: #721c24; }
    .status-late { background-color: #fff3cd; color: #856404; }
    .status-excused { background-color: #cce7ff; color: #004085; }
    
    .attendance-summary-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .ges-compliance {
        border-left: 4px solid #28a745;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Ghana Education System Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-1">
                                <i class="bi bi-clipboard-data me-2"></i>
                                My Attendance Record
                            </h2>
                            <p class="mb-0">Ghana Education Service - Academic Attendance History</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <span class="badge bg-light text-primary fs-6">Student Portal</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Summary -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="bi bi-check-circle-fill text-success fs-1 mb-2"></i>
                    <h5 class="text-muted">Present Days</h5>
                    <h3 class="mb-0 text-success">{{ present_count }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-danger">
                <div class="card-body text-center">
                    <i class="bi bi-x-circle-fill text-danger fs-1 mb-2"></i>
                    <h5 class="text-muted">Absent Days</h5>
                    <h3 class="mb-0 text-danger">{{ absent_count }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-clock-fill text-warning fs-1 mb-2"></i>
                    <h5 class="text-muted">Late Days</h5>
                    <h3 class="mb-0 text-warning">{{ late_count }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <i class="bi bi-clipboard-check-fill text-info fs-1 mb-2"></i>
                    <h5 class="text-muted">Excused Days</h5>
                    <h3 class="mb-0 text-info">{{ excused_count }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- GES Compliance Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card ges-compliance">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="card-title mb-1">
                                <i class="bi bi-clipboard-check me-2"></i>
                                GES Attendance Compliance
                            </h5>
                            <p class="card-text mb-0">
                                Your overall attendance rate: <strong>{{ overall_attendance_rate }}%</strong>
                                {% if overall_attendance_rate >= 80 %}
                                <span class="badge bg-success ms-2">Compliant</span>
                                {% elif overall_attendance_rate >= 70 %}
                                <span class="badge bg-warning ms-2">Needs Improvement</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Below Standard</span>
                                {% endif %}
                            </p>
                            <small class="text-muted">Ghana Education Service requires minimum 80% attendance</small>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar {% if overall_attendance_rate >= 80 %}bg-success{% elif overall_attendance_rate >= 70 %}bg-warning{% else %}bg-danger{% endif %}" 
                                     style="width: {{ overall_attendance_rate }}%">
                                    {{ overall_attendance_rate }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Records -->
    <div class="card shadow">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="bi bi-list-ul me-2"></i>
                Attendance History
            </h5>
            <span class="badge bg-primary">{{ object_list.count }} Records</span>
        </div>
        <div class="card-body">
            {% if object_list %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Day</th>
                            <th>Status</th>
                            <th>Academic Term</th>
                            <th>Period</th>
                            <th>Notes</th>
                            <th>Recorded By</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in object_list %}
                        <tr>
                            <td>
                                <strong>{{ record.date|date:"M j, Y" }}</strong>
                            </td>
                            <td>{{ record.date|date:"l" }}</td>
                            <td>
                                <span class="status-badge status-{{ record.status|lower }}">
                                    <i class="bi bi-{% if record.status == 'present' %}check-circle{% elif record.status == 'absent' %}x-circle{% elif record.status == 'late' %}clock{% else %}clipboard-check{% endif %} me-1"></i>
                                    {{ record.get_status_display }}
                                </span>
                            </td>
                            <td>
                                <small class="text-muted">{{ record.term }}</small>
                            </td>
                            <td>
                                {% if record.period %}
                                <span class="badge bg-info">{{ record.period }}</span>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if record.notes %}
                                <small class="text-muted">{{ record.notes|truncatewords:5 }}</small>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <small>{{ record.recorded_by.get_full_name|default:"System" }}</small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if is_paginated %}
            <nav aria-label="Attendance pagination">
                <ul class="pagination justify-content-center mt-4">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1">First</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                    </li>
                    {% endif %}

                    <li class="page-item active">
                        <span class="page-link">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                        </span>
                    </li>

                    {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-calendar-x fs-1 text-muted"></i>
                <h5 class="mt-3">No Attendance Records Found</h5>
                <p class="text-muted">Your attendance records will appear here once they are recorded.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Important Notice -->
    <div class="alert alert-info mt-4">
        <h6><i class="bi bi-info-circle me-2"></i>Important Notice</h6>
        <p class="mb-0">
            According to Ghana Education Service guidelines, students must maintain at least 80% attendance 
            to be eligible for promotion. Regular attendance is essential for academic success.
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add any interactive functionality here
    console.log('Student attendance page loaded');
});
</script>
{% endblock %}